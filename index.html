<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–û—Ç–∫—Ä—ã—Ç–∫–∞ üíò</title>

<style>
:root{
  --bg1:#ffdde9;
  --bg2:#fff6fb;
  --card:#ffffffcc;
  --text:#1f1f1f;
  --accent:#ff3b6b;
  --yes:#2dd4bf;
  --shadow: 0 22px 70px rgba(0,0,0,.16);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  font-family:system-ui, Arial;
  color: var(--text);
  background:
    radial-gradient(1200px 800px at 20% 15%, var(--bg2), transparent 60%),
    radial-gradient(900px 700px at 85% 70%, #ffe1f0, transparent 60%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  overflow:hidden;

  animation: bgIn 1400ms ease-out 600ms both;
}

@keyframes bgIn{
  from{ filter: blur(7px); transform: scale(1.02); }
  to  { filter: blur(0);  transform: scale(1); }
}

/* ====== –ö–ê–†–¢–û–ß–ö–ê ====== */
.card{
  width:min(720px,92vw);
  min-height:min(560px,86vh);

  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;

  padding:60px 28px 50px;

  border-radius:34px;
  background:var(--card);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.55);

  position:relative;
  text-align:center;

  opacity:0;
  transform: translateY(28px) scale(.975);
  animation: cardIn 1100ms cubic-bezier(.2,.9,.2,1) 600ms both;

  transform-style: preserve-3d;
  will-change: transform, opacity, filter;
  transform-origin:center;
}

@keyframes cardIn{
  0%{ opacity:0; transform: translateY(28px) scale(.975); }
  60%{ opacity:1; transform: translateY(-6px) scale(1.01); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}

.card::before{
  content:"";
  position:absolute; inset:14px;
  border-radius:26px;
  border: 2px dashed rgba(255,59,107,.28);
  pointer-events:none;
}

/* ‚úÖ –ø–ª–∞–≤–Ω–µ–µ/–¥–æ–ª—å—à–µ –ø—Ä–æ–∫—Ä—É—Ç –∫ 3 —ç–∫—Ä–∞–Ω—É */
.card.spin-out{
  animation: spinOut 1650ms cubic-bezier(.18,.85,.18,1) both;
}
@keyframes spinOut{
  0%   { opacity:1; transform: translateY(0) rotate(0deg)    scale(1);    filter: blur(0); }
  35%  { opacity:1; transform: translateY(0) rotate(480deg)  scale(.95);  filter: blur(.6px); }
  70%  { opacity:.92;transform: translateY(0) rotate(1080deg) scale(.88); filter: blur(1.8px); }
  100% { opacity:0; transform: translateY(0) rotate(1440deg) scale(.82);  filter: blur(6px); }
}

.card.spin-in{
  animation: spinIn 1850ms cubic-bezier(.18,.85,.18,1) both;
}
@keyframes spinIn{
  0%   { opacity:0; transform: translateY(0) rotate(-1080deg) scale(.82); filter: blur(7px); }
  55%  { opacity:1; transform: translateY(0) rotate(18deg)    scale(1.01);filter: blur(0); }
  100% { opacity:1; transform: translateY(0) rotate(0deg)     scale(1);   filter: blur(0); }
}

/* ====== –≠–ö–†–ê–ù–´ ====== */
.screen{
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.hidden{ display:none; }

/* ====== –°–ï–†–î–¶–ï ====== */
.heart-wrap{
  margin-bottom:20px;

  opacity:0;
  transform: translateY(-10px) scale(.88);
  animation: popIn 700ms cubic-bezier(.2,.9,.2,1) 1300ms both;
}

@keyframes popIn{
  0%{ opacity:0; transform: translateY(-10px) scale(.88); }
  70%{ opacity:1; transform: translateY(0) scale(1.07); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}

.heart{
  width:150px;
  height:150px;
  background:var(--accent);
  transform:rotate(45deg);
  position:relative;
  border-radius:20px;
  animation:pulse 1.2s infinite;
  cursor: default;
}

.heart.clickable{ cursor:pointer; }

/* ‚úÖ —Å–µ—Ä–¥—Ü–µ –Ω–∞ 2 —ç–∫—Ä–∞–Ω–µ —á—É—Ç—å –ø—Ä–∞–≤–µ–µ */
#screen2 .heart-wrap{
  width:100%;
  display:flex;
  justify-content:center;
}
#bigHeart{
  position:relative;
  left:22px; /* ‚Üê –¥–≤–∏–≥–∞–π 10..40px */
}

.heart:before,
.heart:after{
  content:"";
  width:150px;
  height:150px;
  background:var(--accent);
  border-radius:50%;
  position:absolute;
}
.heart:before{ left:-75px; top:0; }
.heart:after { top:-75px; left:0; }

@keyframes pulse{
  0%,100%{ transform:rotate(45deg) scale(1); }
  50%{ transform:rotate(45deg) scale(1.06); }
}

/* ====== –¢–ï–ö–°–¢ (–ø–µ—á–∞—Ç–∞–Ω–∏–µ) ====== */
h1{
  font-size:clamp(26px,3vw,40px);
  margin:0 0 18px;
  line-height:1.2;
  opacity:0;
}
h1.big{ font-size:clamp(34px,4.5vw,56px); }

.typing-caret::after{
  content:"";
  display:inline-block;
  width:2px;
  height:1em;
  margin-left:6px;
  background: currentColor;
  transform: translateY(2px);
  animation: caretBlink .75s steps(1) infinite;
}
@keyframes caretBlink{ 50%{ opacity:0; } }

/* ====== –ö–ù–û–ü–ö–ò ====== */
.buttons{
  display:flex;
  gap:16px;

  opacity:0;
  transform: translateY(10px);
  pointer-events:none;
}
.buttons.show{
  opacity:1;
  transform: translateY(0);
  transition: opacity 650ms ease, transform 650ms ease;
  pointer-events:auto;
}

.btn{
  border:none;
  padding:14px 28px;
  border-radius:18px;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 14px 28px rgba(0,0,0,.12);
  transition:transform .2s, filter .2s;
}
.btn:active{ transform:scale(.96); }

#yes{ background:var(--yes); color:#053c35; }
#no{
  background:#ff5a7d;
  color:#fff;
  transition:transform .3s cubic-bezier(.2,.8,.2,1);
}

/* ====== –°–û–û–ë–©–ï–ù–ò–ï / –ü–û–î–°–ö–ê–ó–ö–ê ====== */
.msg{
  margin-top:16px;
  font-size:30px;
  font-weight:900;
  opacity:0;
  transition:.4s;
}
.msg.show{ opacity:1; }

.hint{
  margin-top:14px;
  font-size:14px;
  opacity:0;
  transform: translateY(6px);
}

/* ‚úÖ 2 —ç–∫—Ä–∞–Ω: hint –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º */
#screen2 .s2-appear,
#screen2 .hint{
  opacity:0;
  transform: translateY(10px);
}
#screen2.on .s2-appear,
#screen2.on .hint{
  opacity:1;
  transform: translateY(0);
  transition: opacity 800ms ease, transform 800ms ease;
}
#screen2.on .hint{ opacity:.72; }

/* ====== CANVAS ====== */
#fx{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:999;
}
#heartsFx{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:998;
  opacity:0;
  transition: opacity 600ms ease;
}
#heartsFx.show{ opacity:1; }
</style>
</head>

<body>
<canvas id="fx"></canvas>
<canvas id="heartsFx"></canvas>

<div class="card" id="card">

  <!-- SCREEN 1 -->
  <div class="screen" id="screen1">
    <div class="heart-wrap">
      <div class="heart" aria-hidden="true"></div>
    </div>

    <h1 id="title1">–ü—Ä–∏–Ω—Ü–µ—Å—Å–∫–∞, —Ç—ã –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</h1>

    <div class="buttons" id="buttons1">
      <button class="btn" id="yes">–î–∞</button>
      <button class="btn" id="no">–ù–µ—Ç</button>
    </div>

    <div class="msg" id="msg1"></div>
  </div>

  <!-- SCREEN 2 -->
  <div class="screen hidden" id="screen2">
    <div class="heart-wrap" style="opacity:1; transform:none; animation:none;">
      <div class="heart clickable" id="bigHeart" aria-label="–ë–æ–ª—å—à–æ–µ —Å–µ—Ä–¥—Ü–µ"></div>
    </div>

    <h1 class="big s2-appear" id="title2" style="opacity:1;">–£—Ä–∞–∞–∞! üíò –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞!</h1>
    <div class="msg show s2-appear" id="msg2">ü•∞üíûü•∞</div>
    <div class="hint" id="hint2">–∂–º—è–∫–Ω–∏ –Ω–∞ –±–æ–ª—å—à–æ–µ —Å–µ—Ä–¥–µ—á–∫–æ</div>
  </div>

  <!-- SCREEN 3 -->
  <div class="screen hidden" id="screen3">
    <div class="heart-wrap" style="opacity:1; transform:none; animation:none;">
      <div class="heart" aria-hidden="true"></div>
    </div>

    <h1 class="big" id="title3" style="opacity:1;">–õ—é–±–ª—é —Ç–µ–±—è üíñ</h1>
    <div class="msg show" id="msg3">üíòüíòüíò</div>
  </div>

</div>

<script>
/* =========================
   Screen 1: typing sequence
========================= */
const card = document.getElementById('card');

const screen1 = document.getElementById('screen1');
const screen2 = document.getElementById('screen2');
const screen3 = document.getElementById('screen3');

const title1 = document.getElementById('title1');
const buttons1 = document.getElementById('buttons1');

const yesBtn = document.getElementById('yes');
const noBtn  = document.getElementById('no');
const bigHeart = document.getElementById('bigHeart');

const fullText1 = title1.textContent;
title1.textContent = "";
title1.style.opacity = "1";

function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

function typeText(el, text, speed = 45){
  return new Promise((resolve) => {
    let i = 0;
    el.classList.add('typing-caret');
    const timer = setInterval(() => {
      el.textContent += text[i];
      i++;
      if(i >= text.length){
        clearInterval(timer);
        setTimeout(() => {
          el.classList.remove('typing-caret');
          resolve();
        }, 350);
      }
    }, speed);
  });
}

(async () => {
  await sleep(1500);
  await typeText(title1, fullText1, 45);
  buttons1.classList.add('show');
})();

/* =========================
   "–ù–µ—Ç" —É–±–µ–≥–∞–µ—Ç
========================= */
let nx=0, ny=0;
function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }

buttons1.addEventListener('mousemove', e=>{
  const rect = noBtn.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;

  const dist = Math.hypot(e.clientX - cx, e.clientY - cy);
  if(dist > 120) return;

  let dx = cx - e.clientX;
  let dy = cy - e.clientY;

  const len = Math.hypot(dx,dy) || 1;
  dx/=len; dy/=len;

  nx += dx * 70;
  ny += dy * 70;

  nx = clamp(nx, -150, 150);
  ny = clamp(ny, -90, 90);

  noBtn.style.transform = `translate(${nx}px,${ny}px)`;
});

noBtn.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const t = e.touches[0];
  const rect = noBtn.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;

  let dx = cx - t.clientX;
  let dy = cy - t.clientY;

  const len = Math.hypot(dx,dy) || 1;
  dx/=len; dy/=len;

  nx += dx * 90;
  ny += dy * 90;

  nx = clamp(nx, -150, 150);
  ny = clamp(ny, -90, 90);

  noBtn.style.transform = `translate(${nx}px,${ny}px)`;
}, { passive:false });

/* =========================
   Confetti (–ø–ª–∞–≤–Ω–µ–µ –∏ –¥–æ–ª—å—à–µ)
========================= */
const fx = document.getElementById('fx');
const ctx = fx.getContext('2d');

let W=0,H=0;
let parts=[];
let run=false;

function resizeFx(){
  W=window.innerWidth;
  H=window.innerHeight;
  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  fx.width  = Math.floor(W * dpr);
  fx.height = Math.floor(H * dpr);
  fx.style.width = W + "px";
  fx.style.height= H + "px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resizeFx();
window.addEventListener('resize', resizeFx);

function spawnConfettiBurst(mult=1){
  const count = Math.floor(220 * mult);
  for(let i=0;i<count;i++){
    parts.push({
      x: W/2 + (Math.random()*80-40),
      y: H/3 + (Math.random()*40-20),
      vx:(Math.random()-0.5)*10,
      vy:(Math.random()-1.1)*12,
      g: 0.12 + Math.random()*0.08,
      l: 420 + Math.random()*220,      // ‚úÖ –∂–∏–≤—É—Ç –¥–æ–ª—å—à–µ
      s: 2 + Math.random()*3,
      c:`hsl(${Math.random()*360},95%,60%)`
    });
  }
}

function emitConfetti(durationMs=3500){
  const start = performance.now();
  const step = () => {
    const t = performance.now() - start;
    const k = Math.max(0, 1 - t/durationMs);
    spawnConfettiBurst(0.55 * k + 0.15);
    if(t < durationMs) requestAnimationFrame(step);
  };
  step();
}

function tickConfetti(){
  if(!run) return;

  ctx.clearRect(0,0,W,H);

  for(let i=parts.length-1;i>=0;i--){
    const p = parts[i];

    p.vy += p.g;
    p.x  += p.vx;
    p.y  += p.vy;
    p.l--;

    const a = Math.max(0, Math.min(1, p.l/260)); // ‚úÖ –º—è–≥—á–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
    ctx.globalAlpha = a;
    ctx.fillStyle = p.c;
    ctx.fillRect(p.x,p.y,p.s,p.s);

    if(p.l<=0 || p.y>H+120) parts.splice(i,1);
  }

  ctx.globalAlpha = 1;

  requestAnimationFrame(tickConfetti);
}

/* =========================
   Screen switching
========================= */
function showScreen(n){
  screen1.classList.toggle('hidden', n !== 1);
  screen2.classList.toggle('hidden', n !== 2);
  screen3.classList.toggle('hidden', n !== 3);
}

async function transitionToScreen3(){
  card.classList.remove('spin-in');
  card.classList.add('spin-out');
  await sleep(1650);

  showScreen(3);
  card.classList.remove('spin-out');
  card.classList.add('spin-in');
}

/* =========================
   Hearts flying on screen 3
========================= */
const heartsFx = document.getElementById('heartsFx');
const hctx = heartsFx.getContext('2d', { alpha:true });

let HW=0, HH=0, hdpr=1;
let hearts = [];
let heartsRun = false;

function resizeHearts(){
  HW = window.innerWidth;
  HH = window.innerHeight;
  hdpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  heartsFx.width = Math.floor(HW * hdpr);
  heartsFx.height = Math.floor(HH * hdpr);
  heartsFx.style.width = HW + "px";
  heartsFx.style.height = HH + "px";
  hctx.setTransform(hdpr,0,0,hdpr,0,0);
}
resizeHearts();
window.addEventListener('resize', resizeHearts);

function rand(min,max){ return min + Math.random()*(max-min); }

function spawnHearts(){
  hearts = [];
  const count = 38;
  for(let i=0;i<count;i++){
    hearts.push({
      x: rand(0, HW),
      y: rand(HH*0.25, HH+HH*0.7),
      s: rand(10, 22),
      vy: rand(-0.95, -0.35),
      vx: rand(-0.28, 0.28),
      rot: rand(0, Math.PI*2),
      vr: rand(-0.012, 0.012),
      a: rand(0.35, 0.9),
      hue: Math.floor(rand(330, 360))
    });
  }
}

function drawHeartShape(x,y,size,rot,color,alpha){
  hctx.save();
  hctx.translate(x,y);
  hctx.rotate(rot);
  hctx.globalAlpha = alpha;
  hctx.fillStyle = color;

  const s = size;
  hctx.beginPath();
  hctx.moveTo(0, s*0.25);
  hctx.bezierCurveTo(-s*0.8, -s*0.35, -s*0.55, -s*0.95, 0, -s*0.45);
  hctx.bezierCurveTo( s*0.55, -s*0.95,  s*0.8, -s*0.35, 0, s*0.25);
  hctx.closePath();
  hctx.fill();
  hctx.restore();
}

function tickHearts(){
  if(!heartsRun) return;

  hctx.clearRect(0,0,HW,HH);

  for(const p of hearts){
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;

    if(p.y < -80) p.y = HH + 100;
    if(p.x < -80) p.x = HW + 80;
    if(p.x > HW + 80) p.x = -80;

    drawHeartShape(
      p.x, p.y, p.s, p.rot,
      `hsl(${p.hue} 92% 62%)`,
      p.a
    );
  }

  requestAnimationFrame(tickHearts);
}

function startHearts(){
  heartsFx.classList.add('show');
  spawnHearts();
  if(!heartsRun){
    heartsRun = true;
    requestAnimationFrame(tickHearts);
  }
}

/* =========================
   Buttons actions
========================= */
yesBtn.onclick = async () => {
  // screen1 -> screen2
  buttons1.style.display = "none";

  // –∫–æ–Ω—Ñ–µ—Ç—Ç–∏: –¥–æ–ª—å—à–µ –∏ –º—è–≥—á–µ
  emitConfetti(3500);

  if(!run){
    run = true;
    tickConfetti();
  }

  // –ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω 2
  await sleep(350);
  showScreen(2);

  // ‚úÖ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π + –º–µ–ª–∫–∏–π
  requestAnimationFrame(() => screen2.classList.add('on'));
};

bigHeart.addEventListener('click', async () => {
  await transitionToScreen3();
  startHearts();
});
bigHeart.addEventListener('touchstart', async (e) => {
  e.preventDefault();
  await transitionToScreen3();
  startHearts();
}, { passive:false });
</script>

</body>
</html>
